<ibm-loading
  *ngIf="isLoading"
  [isActive]="isLoading"
  size="normal"
  [overlay]="overlay"
>
</ibm-loading>
<div ibmGrid class="bx--grid--full-width" style="padding-left: 1rem">
  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-64">
    <div ibmCol [columnNumbers]="{ lg: 10, md: 10, sm: 6 }">
      <span class="ph03">Material Requisition Form Preview</span>
    </div>
  </div>
  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Company Name</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ companyName | titlecase }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Request By</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ requestByName | titlecase }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Request Ref.</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ requestRef }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Request on Behalf</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ requestOnBehalf | titlecase }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Location</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ location }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Vessel Name</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ vessel }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Remarks</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ remarks }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Type of Services</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      {{ typeOfServices }}
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
    <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Status</div>
    <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
      <span
        [ngStyle]="{
          color: status.toLowerCase().includes('pending') ? 'red' : '#161616'
        }"
        >{{ status | titlecase }}
      </span>
    </div>
  </div>

  <!----------------------------------  material table ------------------------------------>
  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
    <div ibmCol [columnNumbers]="{ lg: 12, md: 10, sm: 6 }" class="pl-0 pr-0">
      <span class="ph03">Material Requisition</span>
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
    <div ibmCol [columnNumbers]="{ lg: 12, md: 10, sm: 6 }" class="pl-0 pr-0">
      <ibm-table-container>
        <div class="horizontal-overflow-table">
          <table class="bx--data-table">
            <thead>
              <tr>
                <th>No.</th>
                <th>Underdeck Services</th>
                <th>Tank No.</th>
                <th>Product Name</th>
                <th>Barrels Qty.</th>
                <th>Tonnes Qty.</th>
                <th>Start Time</th>
                <!-- <th>End Time</th> -->
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of materialList; let i = index">
                <td>{{ i + 1 }}.</td>
                <!-- <td>{{item.item | titlecase}}</td> -->
                <td>{{ item.underdeck_services }}</td>
                <td>{{ item.tank_no }}</td>
                <td>{{ item.product }}</td>
                <td>{{ item.barrels_quantity }}</td>
                <td>{{ item.tonnes_quantity }}</td>
                <td>{{ item.start_date }} {{ item.start_time }}</td>
                <!-- <td>{{item.end_date}} {{item.end_time}}</td> -->
              </tr>
              <tr *ngIf="materialList.length <= 0">
                <td align="center" colspan="9" class="no-data">
                  No data available
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ibm-table-container>
    </div>
  </div>

  <!----------------------------------   Documents List Table ----------------------------------->
  <div>
    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
      <div ibmCol [columnNumbers]="{ lg: 12, md: 10, sm: 6 }" class="pl-0 pr-0">
        <span class="ph03">Documents List</span>
      </div>
    </div>
    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
      <div ibmCol [columnNumbers]="{ lg: 12, md: 10, sm: 6 }">
        <div class="form-item">
          <ibm-table-container>
            <div class="horizontal-overflow-table">
              <table class="bx--data-table">
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Doc. Type</th>
                    <th>Waste Code</th>
                    <th>Doc. ID</th>
                    <th>Uploaded By</th>
                    <th>Date/Time</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let list of documentPreview; let index = index">
                    <td>{{ index + 1 }}</td>
                    <td *ngIf="list.docPath">
                      <a
                        style="text-decoration: none"
                        (click)="openFile(list.docPath)"
                        href="javascript:void(0);"
                        target="_blank"
                        >{{ list.docType }}</a
                      >
                    </td>
                    <td *ngIf="list.fromApi">
                      <button
                        type="button"
                        ibmButton="ghost"
                        class="downloadBtn"
                        (click)="downloadFiles(list.id, list.docID)"
                      >
                        {{ list.docType }}
                      </button>
                    </td>
                    <td>{{ list.wasteCode }}</td>
                    <td>{{ list.docID }}</td>
                    <td>{{ list.uploadBy }}</td>
                    <td>{{ list.dateTime | date : "dd/MM/y HH:mm" }}</td>
                  </tr>
                  <tr *ngIf="documentPreview.length < 1">
                    <td align="center" colspan="8" class="no-data">
                      No data available
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </ibm-table-container>
        </div>
      </div>
    </div>
  </div>

  <!--------------------------- Button -------------------->

  <div
    ibmRow
    class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32 pb-64"
  >
    <div ibmCol [columnNumbers]="{ lg: 12 }">
      <button
        *ngIf="!status.toLowerCase().includes('init')"
        type="button"
        ibmButton="secondary"
        [routerLink]="['/operation-system/marine-material-requisition-list']"
        style="margin-right: 24px"
      >
        Back
      </button>
      <button
        *ngIf="status.toLowerCase().includes('endorsement')"
        (click)="openReject = true"
        type="button"
        ibmButton="secondary"
        class="btn-178"
        style="margin-right: 24px"
      >
        Amend
      </button>
      <button
        *ngIf="status.toLowerCase().includes('endorsement')"
        type="button"
        ibmButton="primary"
        (click)="openEndorse = true"
      >
        Endorse
      </button>

      <div class="actions">
        <button
          *ngIf="status.toLowerCase().includes('init')"
          type="button"
          ibmButton="secondary"
          [routerLink]="[
            '/operation-system/marine-material-requisition-form',
            RequestNo
          ]"
          style="margin-right: 24px; width: 178px; height: 40px"
        >
          Edit
        </button>
        <button
          *ngIf="status.toLowerCase().includes('init')"
          type="submit"
          ibmButton="primary"
          style="width: 178px; height: 40px"
          (click)="open = true"
        >
          Submit
        </button>
      </div>
    </div>
  </div>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="openEndorse" (overlaySelected)="openEndorse = false">
        <ibm-modal-header (closeSelect)="openEndorse = false">
          <h4 style="font-weight: bold">Confirmation</h4>
        </ibm-modal-header>
        <section ibmModalContent>
          <h4>Are you sure you want to endorse the request?</h4>
        </section>
        <ibm-modal-footer>
          <button
            class="bx--btn bx--btn--secondary"
            (click)="openEndorse = false"
          >
            Cancel
          </button>
          <button
            class="bx--btn bx--btn--primary"
            modal-primary-focus
            (click)="endorseRequest()"
          >
            Endorse
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="openReject" (overlaySelected)="openReject = false">
        <ibm-modal-header (closeSelect)="openReject = false">
          <h4 style="font-weight: bold">Confirmation</h4>
        </ibm-modal-header>
        <section ibmModalContent>
          <h4 class="mb-4">Are you sure you want to submit the amendment?</h4>

          <ibm-label ibmModalContentText>
            Reason(s)
            <textarea
              ibmTextArea
              aria-label="textarea"
              [rows]="6"
              name="ammend"
              placeholder="Descriptions here"
              (blur)="onblurAmend($event)"
              [value]="amendNotes"
            ></textarea>
          </ibm-label>
        </section>
        <ibm-modal-footer>
          <button
            class="bx--btn bx--btn--secondary"
            (click)="openReject = false"
          >
            Cancel
          </button>
          <button
            class="bx--btn bx--btn--primary"
            modal-primary-focus
            (click)="rejectRequest()"
          >
            Amend
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>

  <ibm-modal
    class="addNewDocPreviewModal"
    [open]="addNewDocPreview"
    [trigger]="openModal"
    (overlaySelected)="addNewDocPreview = false"
  >
    <ibm-modal-header (closeSelect)="addNewDocPreview = false">
      <p class="bx--modal-header__label bx--type-delta"></p>
      <p
        class="bx--modal-header__heading bx--type-beta ph03"
        style="font-weight: 600"
      >
        Add New Document
      </p>
    </ibm-modal-header>
    <div class="bx--modal-content">
      <div class="bx--text-input__field-wrapper">
        <div class="form-item">
          <ibm-dropdown
            label="Document Type"
            placeholder="Please Select"
            [appendInline]="true"
            [dropUp]="false"
            name="docType"
            #types
            (selected)="selectDoc($event)"
            itemValueKey="content"
            required
            [invalid]="invalidDocType"
            invalidText="Document Type is required"
          >
            <ibm-dropdown-list [items]="documentTypeList"></ibm-dropdown-list>
          </ibm-dropdown>
        </div>

        <div class="form-item">
          <ibm-label>
            Waste Code (for Schedule Waste works only)
            <input
              ibmText
              type="text"
              name="wasteCode"
              #waste
              (blur)="onblurWaste($event)"
            />
          </ibm-label>
        </div>

        <!-- <div class="form-item">
          <ibm-label [invalid]="invalidDocID"
          helperText="Please insert dash (-) if not applicable">
            Document ID
            <input
              ibmText
              type="text"
              placeholder="XXXXXXXXXXXX"
              name="docID"
              #docsID
              (blur)="onblurDoc($event)"
              required
              [invalid]="invalidDocID"
            />
          </ibm-label>
        </div> -->

        <div class="form-item">
          <ibm-label helperText="Please insert dash (-) if not applicable">
            Document ID
            <input
              ibmText
              type="text"
              placeholder="XXXXXXXXXXXX"
              name="docID"
              #docsID
              (blur)="onblurDoc($event)"
            />
          </ibm-label>
        </div>

        <div class="form-item">
          <ibm-file-uploader
            [ngClass]="{ 'invalid-file': invalidUpload }"
            title="Upload Related Documents"
            description="Max. file size is 5mb. Supported file types are .jpg, .png, and .pdf"
            [accept]="accept"
            [multiple]="multiple"
            [(files)]="files"
            drop="true"
            #inputFile
            dropText="Drag and drop ﬁles here or click to upload"
            name="upload"
            (filesChange)="onDropped($event)"
          >
          </ibm-file-uploader>
          <div *ngIf="invalidUpload" class="invalid-class-label">
            File required
          </div>
        </div>
      </div>
    </div>
    <ibm-modal-footer>
      <ng-container>
        <button
          class="bx--btn bx--btn--secondary"
          (click)="addNewDocPreview = false"
          size="lg"
        >
          Cancel
        </button>
        <button
          ibmButton="primary"
          (click)="onSaveDocumentList()"
          [attr.modal-primary-focus]="true"
          size="lg"
        >
          Save
        </button>
      </ng-container>
    </ibm-modal-footer>
  </ibm-modal>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="open" (overlaySelected)="open = false">
        <ibm-modal-header (closeSelect)="open = false"> </ibm-modal-header>
        <section ibmModalContent style="margin-bottom: 30px">
          <h4>
            Are you sure you want to submit this request? Make sure all the
            details are correct before you submit.
          </h4>
        </section>
        <ibm-modal-footer>
          <button class="bx--btn bx--btn--secondary" (click)="open = false">
            Cancel
          </button>
          <button
            class="bx--btn bx--btn--primary"
            modal-primary-focus
            (click)="submitForm()"
          >
            Submit
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="modalTimeout" (overlaySelected)="modalTimeout = false">
        <ibm-modal-header (closeSelect)="modalTimeout = false">
          <h4 style="font-weight: bold">Session timeout</h4>
        </ibm-modal-header>
        <!-- <section ibmModalContent style="height: unset;"> -->
        <section ibmModalContent>
          <!-- <h3 ibmModalContentText class="bx--modal-content__regular-content modal-text">
                    Oops! You need to relogin again and make a new request to continue<br>
                  </h3> -->
          <h4 ibmModalContentText>
            Failed to upload file. Please relogin again to upload file
          </h4>
        </section>
        <ibm-modal-footer>
          <!-- <button class="bx--btn bx--btn--secondary" (click)="modalTimeout = false">Back</button> -->
          <button
            type="submit"
            class="bx--btn bx--btn--primary"
            (click)="logout()"
          >
            Log Out
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>
</div>
