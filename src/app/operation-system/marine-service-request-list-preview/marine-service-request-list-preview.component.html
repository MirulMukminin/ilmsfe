<ibm-loading
  *ngIf="isLoading"
  [isActive]="isLoading"
  size="normal"
  [overlay]="overlay"
>
</ibm-loading>
<div ibmGrid class="bx--grid--full-width">
  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
    <div ibmCol [columnNumbers]="{ lg: 10, md: 10, sm: 10 }">
      <ibm-breadcrumb [noTrailingSlash]="true">
        <ibm-breadcrumb-item [current]="true">
          Operation System
        </ibm-breadcrumb-item>

        <ibm-breadcrumb-item>
          <a routerLink="/operation-system/marine-berth-request-list">Marine</a>
        </ibm-breadcrumb-item>

        <ibm-breadcrumb-item [current]="true">
          Request Form
        </ibm-breadcrumb-item>
      </ibm-breadcrumb>
    </div>
  </div>

  <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
    <div ibmCol [columnNumbers]="{ lg: 6, md: 6, sm: 6 }">
      <div>
        <span class="ph03">Service Request Form Preview</span>
      </div>
    </div>
  </div>
  <form #berthForm="ngForm" (ngSubmit)="onSubmit(berthForm)">
    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Request Number</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ requestNumberNew }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Company Name</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ companyName | titlecase }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Request By</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ requestBy | titlecase }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Terminal</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ terminal }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Vessel Name</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ vessel }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">
        Request on Behalf
      </div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ requestOnBehalf | titlecase }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">PO Number</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ poNumber }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">
        Est. Arrival Date & ETA
      </div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ eaDate | date : "dd/MM/y HH:mm" }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">
        Est. Departure Date & ETD
      </div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ edDate | date : "dd/MM/y HH:mm" }}
      </div>
    </div>

    <!-- <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
            <div ibmCol [columnNumbers]="{ 'lg':2 }" class="ph01">
                Last Location
            </div>
            <div ibmCol [columnNumbers]="{ 'lg':6 }" class="bs01">
                {{ lastLocation }}
            </div>
        </div>

        <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
            <div ibmCol [columnNumbers]="{ 'lg':2 }" class="ph01">
                Next Location
            </div>
            <div ibmCol [columnNumbers]="{ 'lg':6 }" class="bs01">
                {{ nextLocation }}
            </div>
        </div> -->

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Agent</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ agent | titlecase }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Remarks</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        {{ remarks }}
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24">
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01">Status</div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bs01">
        <span
          [ngStyle]="{
            color: status.toLowerCase().includes('pending') ? 'red' : '#161616'
          }"
          >{{ status | titlecase }}</span
        >
      </div>
    </div>

    <div
      *ngIf="!status.toLowerCase().includes('cancel')"
      ibmRow
      class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-24"
    >
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01"></div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01"></div>
    </div>

    <div
      ibmRow
      class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32"
      *ngIf="
        !status.toLowerCase().includes('endorse') &&
        !status.toLowerCase().includes('init')
      "
    >
      <div ibmCol [columnNumbers]="{ lg: 2 }" class="ph01"></div>
      <div ibmCol [columnNumbers]="{ lg: 6 }" class="bl01">
        <div class="singleDate-notif">
          <div class="pt-16" *ngIf="dateFlag == true">
            <ibm-toast
              style="width: 100%"
              [notificationObj]="{
                type: 'info',
                template: customToastContent,
                lowContrast: true,
                title: 'You will be charged if you cancel this request',
                myData: {
                  subtitle:
                    'Charges could be applied to this cancellation due to Mooring and Unmooring request. For more information, please contact KSB Admin.'
                },
                showClose: showClose
              }"
            >
            </ibm-toast>
            <ng-template #customToastContent let-data>
              <div class="d-flex">
                <div>
                  <p class="ph01" style="margin-bottom: 0px" ibmToastTitle>
                    {{ data.title }}
                  </p>
                  <p ibmToastSubtitle>{{ data.myData.subtitle }}</p>
                </div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <!----------------------------------   Documents List Table ----------------------------------->

    <div>
      <div
        ibmRow
        class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32"
      >
        <div
          ibmCol
          [columnNumbers]="{ lg: 12, md: 10, sm: 6 }"
          class="pl-0 pr-0"
        >
          <span class="ph03">Documents List</span>
        </div>
      </div>
      <div
        ibmRow
        class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32"
      >
        <div ibmCol [columnNumbers]="{ lg: 12, md: 10, sm: 6 }">
          <div class="form-item">
            <ibm-table-container>
              <div class="horizontal-overflow-table">
                <table class="bx--data-table">
                  <thead>
                    <tr>
                      <th>No.</th>
                      <th>Doc. Type</th>
                      <th>Doc. ID</th>
                      <th>Uploaded By</th>
                      <th>Date/Time</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let list of documentList; let index = index">
                      <td>{{ index + 1 }}.</td>
                      <td *ngIf="list.fromApi">
                        <button
                          type="button"
                          ibmButton="ghost"
                          class="downloadBtn"
                          (click)="downloadFiles(list.id, list.docID)"
                        >
                          {{ list.docType }}
                        </button>
                      </td>
                      <td>{{ list.docID }}</td>
                      <td>{{ list.uploadBy }}</td>
                      <td>{{ list.dateTime | date : "dd/MM/y HH:mm" }}</td>
                    </tr>
                    <tr *ngIf="documentList.length < 1">
                      <td align="center" colspan="8" class="no-data">
                        No data available
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </ibm-table-container>
          </div>
        </div>
      </div>
    </div>

    <!----------------------------------  Work Program table ------------------------------------>
    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
      <div ibmCol [columnNumbers]="{ lg: 12, md: 10, sm: 6 }" class="pl-0 pr-0">
        <span class="ph03">General Works</span>
      </div>
    </div>

    <div ibmRow class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32">
      <div ibmCol [columnNumbers]="{ lg: 12, md: 10, sm: 6 }" class="pl-0 pr-0">
        <ibm-table-container>
          <div class="horizontal-overflow-table">
            <table class="bx--data-table">
              <thead>
                <tr>
                  <th>No.</th>
                  <th>Item</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of generalWorksList; let i = index">
                  <td>{{ i + 1 }}.</td>
                  <td>{{ item.item | titlecase }}</td>
                  <td>{{ item.remarks }}</td>
                </tr>
                <tr *ngIf="generalWorksList.length <= 0">
                  <td align="center" colspan="9" class="no-data">
                    No data available
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </ibm-table-container>
      </div>
    </div>

    <!----------------------------------  Underdeck table ------------------------------------>

    <div>
      <div
        ibmRow
        class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32"
      >
        <div
          ibmCol
          [columnNumbers]="{ lg: 12, md: 10, sm: 6 }"
          class="pl-0 pr-0"
        >
          <span class="ph03">Scope of Work</span>
        </div>
      </div>

      <div
        ibmRow
        class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32 pb-64"
      >
        <div
          ibmCol
          [columnNumbers]="{ lg: 12, md: 10, sm: 6 }"
          class="pl-0 pr-0"
        >
          <div class="form-item">
            <ibm-table-container>
              <div class="horizontal-overflow-table">
                <table class="bx--data-table">
                  <thead>
                    <tr>
                      <th>No.</th>
                      <th>Item</th>
                      <th>Quantity In (MT)</th>
                      <th>Quantity Out (MT)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of underdeckList; let i = index">
                      <td>{{ i + 1 }}.</td>
                      <td>{{ item.item }}</td>
                      <td>{{ item.requestQuantityIn }}</td>
                      <td>{{ item.requestQuantityOut }}</td>
                    </tr>
                    <tr *ngIf="underdeckList.length <= 0">
                      <td align="center" colspan="9" class="no-data">
                        No data available
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </ibm-table-container>
          </div>
        </div>
      </div>
    </div>

    <ibm-modal
      class="addNewDocPreviewModal"
      [open]="addNewDocPreview"
      [trigger]="openModal"
      (overlaySelected)="addNewDocPreview = false"
    >
      <ibm-modal-header (closeSelect)="addNewDocPreview = false">
        <p class="bx--modal-header__label bx--type-delta"></p>
        <p
          class="bx--modal-header__heading bx--type-beta ph03"
          style="font-weight: 600"
        >
          Add New Document
        </p>
      </ibm-modal-header>
      <div class="bx--modal-content">
        <div class="bx--text-input__field-wrapper">
          <div class="form-item">
            <ibm-dropdown
              label="Document Type"
              placeholder="Please Select"
              [appendInline]="true"
              [dropUp]="false"
              name="docType"
              (selected)="selectDoc($event)"
              itemValueKey="content"
              required
              [invalid]="invalidDocType"
              invalidText="Document Type is required"
            >
              <ibm-dropdown-list [items]="documentTypeList"></ibm-dropdown-list>
            </ibm-dropdown>
          </div>

          <div class="form-item">
            <ibm-label>
              Waste Code (for Schedule Waste works only)
              <input
                ibmText
                type="text"
                name="wasteCode"
                #waste
                (blur)="onblurWaste($event)"
              />
            </ibm-label>
          </div>

          <div class="form-item">
            <ibm-label helperText="Please insert dash (-) if not applicable">
              Document ID
              <input
                ibmText
                type="text"
                placeholder="XXXXXXXXXXXX"
                name="docID"
                #docsID
                (blur)="onblurDoc($event)"
              />
            </ibm-label>
          </div>

          <div class="form-item">
            <ibm-file-uploader
              [ngClass]="{ 'invalid-file': invalidUpload }"
              title="Upload Related Documents"
              description="Max. file size is 5mb. Supported file types are .jpg, .png, and .pdf"
              [accept]="accept"
              [multiple]="multiple"
              [(files)]="files"
              drop="true"
              #inputFile
              dropText="Drag and drop ﬁles here or click to upload"
              name="upload"
              (filesChange)="onDropped($event)"
            >
            </ibm-file-uploader>
            <div *ngIf="invalidUpload" class="invalid-class-label">
              File required
            </div>
          </div>
        </div>
      </div>
      <ibm-modal-footer>
        <ng-container>
          <button
            class="bx--btn bx--btn--secondary"
            (click)="cancelModal()"
            size="lg"
          >
            Cancel
          </button>
          <button
            ibmButton="primary"
            (click)="onSaveDocumentList()"
            [attr.modal-primary-focus]="true"
            size="lg"
          >
            Save
          </button>
        </ng-container>
      </ibm-modal-footer>
    </ibm-modal>
  </form>

  <!--------------------------- Button -------------------->

  <div
    ibmRow
    class="bx--offset-max-2 bx--offset-xlg-2 bx--offset-lg-3 pt-32 pb-64"
  >
    <div ibmCol [columnNumbers]="{ lg: 12 }">
      <button
        type="button"
        ibmButton="secondary"
        [routerLink]="['/operation-system/marine-service-request-list']"
        style="margin-right: 24px"
      >
        Back
      </button>
      <button
        *ngIf="status.toLowerCase().includes('endorsement')"
        (click)="openReject = true"
        type="button"
        ibmButton="secondary"
        style="margin-right: 24px"
        class="btn-178"
      >
        Amend
      </button>

      <button
        *ngIf="status.toLowerCase().includes('endorsement')"
        type="button"
        ibmButton="primary"
        (click)="openEndorse = true"
      >
        Endorse
      </button>
    </div>
  </div>

  <!-- Modal (Cancel Request)-->
  <!-- <div ibmRow>
        <div ibmCol [columnNumbers]="{ 'lg':10 }">
            <ibm-modal [open]="open" (overlaySelected)="open = false">
                <ibm-modal-header (closeSelect)="open = false">
                </ibm-modal-header>
                <section ibmModalContent>
                    <h4>Are you sure you want to cancel this request? </h4>
                </section>
                <ibm-modal-footer>
                    <button class="bx--btn bx--btn--secondary" (click)="open = false">Back</button>
                    <button class="bx--btn bx--btn--primary" (click)="deleteJobRequest()">Cancel Request</button>
                </ibm-modal-footer>
            </ibm-modal>
        </div>
    </div> -->

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="open" (overlaySelected)="open = false">
        <ibm-modal-header (closeSelect)="open = false"> </ibm-modal-header>
        <section ibmModalContent *ngIf="!flagCharge || !dateFlag">
          <h4 style="font-weight: bold">Confirmation</h4>
          <h4>Are you sure you want to cancel this service request?</h4>
          <h4>Any cancellation of job cannot be undone after this.</h4>
        </section>
        <section ibmModalContent *ngIf="flagCharge && dateFlag">
          <h4 style="font-weight: bold">Confirmation</h4>
          <h4>
            Charges could be applied to this service request cancellation under
            certain conditions.
          </h4>
          <h4>
            Any cancellation of service request cannot be undone after this.
          </h4>
          <h4>
            For more information, please contact Marine Admin - Tel: 09-863 4378
          </h4>
        </section>
        <ibm-modal-footer>
          <button class="bx--btn bx--btn--secondary" (click)="open = false">
            Back
          </button>
          <button class="bx--btn bx--btn--primary" (click)="deleteJobRequest()">
            Cancel Request
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="openRemove" (overlaySelected)="openRemove = false">
        <ibm-modal-header (closeSelect)="openRemove = false">
          <h4 style="font-weight: bold">Confirmation</h4>
        </ibm-modal-header>
        <section ibmModalContent>
          <h4>Are you sure you want to remove this item?</h4>
        </section>
        <ibm-modal-footer>
          <button
            class="bx--btn bx--btn--secondary"
            (click)="openRemove = false"
          >
            Cancel
          </button>
          <button
            class="bx--btn bx--btn--primary"
            modal-primary-focus
            (click)="deleteDocList()"
          >
            Remove
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="openEndorse" (overlaySelected)="openEndorse = false">
        <ibm-modal-header (closeSelect)="openEndorse = false">
          <h4 style="font-weight: bold">Confirmation</h4>
        </ibm-modal-header>
        <section ibmModalContent>
          <h4>Are you sure you want to endorse the request?</h4>
        </section>
        <ibm-modal-footer>
          <button
            class="bx--btn bx--btn--secondary"
            (click)="openEndorse = false"
          >
            Cancel
          </button>
          <button
            class="bx--btn bx--btn--primary"
            modal-primary-focus
            (click)="endorseRequest()"
          >
            Endorse
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="openReject" (overlaySelected)="openReject = false">
        <ibm-modal-header (closeSelect)="openReject = false">
          <h4 style="font-weight: bold">Confirmation</h4>
        </ibm-modal-header>
        <section ibmModalContent>
          <h4 class="mb-4">Are you sure you want to submit the amendment?</h4>

          <ibm-label ibmModalContentText>
            Reason(s)
            <textarea
              ibmTextArea
              aria-label="textarea"
              [rows]="6"
              name="ammend"
              placeholder="Descriptions here"
              (blur)="onblurAmend($event)"
              [value]="amendNotes"
            ></textarea>
          </ibm-label>
        </section>
        <ibm-modal-footer>
          <button
            class="bx--btn bx--btn--secondary"
            (click)="openReject = false"
          >
            Cancel
          </button>
          <button
            class="bx--btn bx--btn--primary"
            modal-primary-focus
            (click)="rejectRequest()"
          >
            Remove
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>

  <div ibmRow>
    <div ibmCol [columnNumbers]="{ lg: 10 }">
      <ibm-modal [open]="modalTimeout" (overlaySelected)="modalTimeout = false">
        <ibm-modal-header (closeSelect)="modalTimeout = false">
          <h4 style="font-weight: bold">Session timeout</h4>
        </ibm-modal-header>
        <!-- <section ibmModalContent style="height: unset;"> -->
        <section ibmModalContent>
          <!-- <h3 ibmModalContentText class="bx--modal-content__regular-content modal-text">
                      Oops! You need to relogin again and make a new request to continue<br>
                    </h3> -->
          <h4 ibmModalContentText>
            Failed to upload file. Please relogin again to upload file
          </h4>
        </section>
        <ibm-modal-footer>
          <!-- <button class="bx--btn bx--btn--secondary" (click)="modalTimeout = false">Back</button> -->
          <button
            type="submit"
            class="bx--btn bx--btn--primary"
            (click)="logout()"
          >
            Log Out
          </button>
        </ibm-modal-footer>
      </ibm-modal>
    </div>
  </div>
</div>
